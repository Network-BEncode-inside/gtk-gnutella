?RCS: $Id$
?RCS:
?RCS: @COPYRIGHT@
?RCS:
?MAKE:GCC_pipe: Trylink cat ccflags gccversion optimize
?MAKE:	-pick add $@ %<
?T:flag result saved_ccflags
?LINT:change ccflags
: check whether -pipe should be used
flag='-pipe'
echo " "
echo "Checking whether $flag should be used..." >&4
case "$gccversion" in
'');;
*)
	case "$ccflags $optimize" in
	*-save-temps*);;
	*-pipe*);;
	*)
		$cat >try.c <<'EOC'
int main(void)
{
	return 0;
}
EOC
		saved_ccflags=$ccflags
		ccflags="$flag $ccflags"

		result=''
		set result
		eval $trylink
	
		case "$result" in
		"$define")
			$cat >try.c <<EOC
main("This is not C")
{
	(. || 
	switch (**1) { case 1: case 1: }
}
EOC
?X: trylink could "Whoa there" if we do not reset this variable
			result=''
			set result
			eval $trylink
	
			case "$result" in
			"$define")
				echo "With $flag the compiler seems to see no code."
				ccflags=$saved_ccflags
				;;
			"$undef")
				echo "(Adding $flag)"
				;;
			esac
			;;
		"$undef")
			ccflags=$saved_ccflags
			;;
		esac
		;;
	esac
	;;
esac

